<!DOCTYPE html>
<html lang="kn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡≤¶‡≥à‡≤®‡≤Ç‡≤¶‡≤ø‡≤® ‡≤¨‡≥à‡≤¨‡≤≤‡≥ç ‡≤™‡≤¶‡≥ç‡≤Ø</title>
  <style>
    :root {
      --primary: #4a90e2;
      --secondary: #f1f1f1;
      --text: #333;
      --accent: #007bff;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: var(--secondary);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 10px;
    }

    .app-container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      max-width: 500px;
      width: 100%;
      padding: 16px;
      box-sizing: border-box;
      text-align: center;
      position: relative;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity:0; transform: translateY(10px);}
      to { opacity:1; transform: translateY(0);}
    }

    h1 { font-size:1.4em; color: var(--primary); margin-bottom:8px; }
    h2 { font-size:1em; color:#666; margin-bottom:16px; }

    canvas#verse-canvas {
      width: 100%;
      border-radius: 12px;
      margin-bottom: 16px;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap:10px;
      justify-content: center;
      margin-bottom:10px;
    }

    button {
      background: var(--accent);
      color:white;
      border:none;
      padding:10px 16px;
      border-radius:6px;
      cursor:pointer;
      transition:0.3s;
    }

    button:hover { background:#0056b3; }

    .toast {
      position: fixed;
      bottom:30px;
      left:50%;
      transform:translateX(-50%);
      background:#222;
      color:#fff;
      padding:10px 20px;
      border-radius:30px;
      font-size:0.9em;
      opacity:0;
      pointer-events:none;
      transition:opacity 0.4s;
    }

    .toast.show { opacity:1; pointer-events:auto; }

    .banner-ads { margin-top:10px; text-align:center; }
  </style>
</head>
<body>
  <div class="app-container">
    <h1>‡≤¶‡≥à‡≤®‡≤Ç‡≤¶‡≤ø‡≤® ‡≤¨‡≥à‡≤¨‡≤≤‡≥ç ‡≤™‡≤¶‡≥ç‡≤Ø</h1>
    <h2 id="verse-ref">Ë™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...</h2>
    <canvas id="verse-canvas" width="500" height="500"></canvas>
    <div class="buttons">
      <button onclick="generateVerseImage()">üîÑ ‡≤π‡≥ä‡≤∏ ‡≤™‡≤¶‡≥ç‡≤Ø</button>
      <button onclick="downloadImage()">‚¨áÔ∏è ‡≤á‡≤Æ‡≥á‡≤ú‡≥ç ‡≤°‡≥å‡≤®‡≥ç‡≤≤‡≥ã‡≤°‡≥ç</button>
      <button onclick="shareImage()">üì§ ‡≤π‡≤Ç‡≤ö‡≤ø‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≤ø</button>
    </div>

    <!-- Adsterra Banner -->
    <div class="banner-ads">
      <script type="text/javascript">
        atOptions = {
          'key' : 'YOUR_ADSTERAA_KEY',
          'format' : 'iframe',
          'height' : 60,
          'width' : 468,
          'params' : {}
        };
      </script>
      <script type="text/javascript" src="//www.profitabledisplaynetwork.com/YOUR_ADSTERAA_KEY/invoke.js"></script>
    </div>
  </div>

  <div id="toast" class="toast">‡≤®‡≤ï‡≤≤‡≥Å ‡≤Æ‡≤æ‡≤°‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü!</div>

  <script>
    const canvas = document.getElementById("verse-canvas");
    const ctx = canvas.getContext("2d");
    const verseRefEl = document.getElementById("verse-ref");

    let verses = [];
    let images = ["1.jpg","2.jpg","3.jpg","4.jpg","5.jpg","6.jpg","7.jpg","8.jpg","9.jpg","10.jpg"];

    function showToast(msg){
      const t = document.getElementById("toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"),2500);
    }

    async function loadVerses(){
      try{
        const res = await fetch("kn_kjv.json");
        const data = await res.json();
        if(!Array.isArray(data)) throw new Error("JSON structure invalid");
        verses = data;
      }catch(err){
        verseRefEl.textContent = "‡≤ï‡≤®‡≥ç‡≤®‡≤° ‡≤¨‡≥à‡≤¨‡≤≤‡≥ç ‡≤≤‡≥ã‡≤°‡≥ç ‡≤Ü‡≤ó‡≤≤‡≤ø‡≤≤‡≥ç‡≤≤";
        console.error("Failed to load Kannada Bible:", err);
      }
    }

    function getRandomVerse(){
      if(!verses.length) return {verse:"‡≤™‡≤¶‡≥ç‡≤Ø ‡≤≤‡≤≠‡≥ç‡≤Ø‡≤µ‡≤ø‡≤≤‡≥ç‡≤≤", ref:""};
      const v = verses[Math.floor(Math.random()*verses.length)];
      return { verse: v.text || v.verse, ref: v.reference || v.ref };
    }

    function getRandomImage(){
      const imgName = images[Math.floor(Math.random()*images.length)];
      const img = new Image();
      img.src = imgName;
      return img;
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight){
      const words = text.split(" ");
      let line="";
      const lines=[];
      for(let n=0;n<words.length;n++){
        const testLine = line + words[n] + " ";
        if(ctx.measureText(testLine).width>maxWidth && n>0){
          lines.push(line);
          line = words[n]+" ";
        } else line = testLine;
      }
      lines.push(line);

      const totalHeight = lines.length*lineHeight;
      let startY = y - totalHeight/2;
      for(let i=0;i<lines.length;i++){
        ctx.fillText(lines[i], x, startY + i*lineHeight);
      }
    }

    async function generateVerseImage(){
      ctx.fillStyle="#ddd";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle="#333";
      ctx.font="20px Segoe UI";
      ctx.textAlign="center";
      ctx.fillText("‡≤≤‡≥ã‡≤°‡≥ç ‡≤Ü‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü...", canvas.width/2, canvas.height/2);

      const {verse, ref} = getRandomVerse();
      verseRefEl.textContent = ref;

      const bg = getRandomImage();
      bg.onload = ()=>{
        ctx.drawImage(bg,0,0,canvas.width,canvas.height);
        ctx.fillStyle="rgba(0,0,0,0.4)";
        ctx.fillRect(0,0,canvas.width,canvas.height);

        ctx.fillStyle="#fff";
        ctx.textAlign="center";
        ctx.textBaseline="middle";
        ctx.font="bold 24px Segoe UI";
        wrapText(ctx, verse, canvas.width/2, canvas.height/2, canvas.width-40,34);
      };
    }

    function downloadImage(){
      const link = document.createElement("a");
      link.download="verse.png";
      link.href=canvas.toDataURL("image/png");
      link.click();
    }

    async function shareImage(){
      if(navigator.share && navigator.canShare){
        canvas.toBlob(async(blob)=>{
          const file = new File([blob],"verse.png",{type:"image/png"});
          if(navigator.canShare({files:[file]})){
            try{ await navigator.share({files:[file], title:"‡≤¶‡≥à‡≤®‡≤Ç‡≤¶‡≤ø‡≤® ‡≤¨‡≥à‡≤¨‡≤≤‡≥ç ‡≤™‡≤¶‡≥ç‡≤Ø", text:"‡≤à ‡≤™‡≤¶‡≥ç‡≤Ø‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≥ã‡≤°‡≤ø!"});}
            catch(err){ console.log("Share failed:", err);}
          } else { alert("‡≤à ‡≤∏‡≤æ‡≤ß‡≤®‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤π‡≤Ç‡≤ö‡≤ø‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≤≤‡≥Å ‡≤∏‡≤æ‡≤ß‡≥ç‡≤Ø‡≤µ‡≤ø‡≤≤‡≥ç‡≤≤"); }
        });
      } else { alert("‡≤¨‡≥ç‡≤∞‡≥å‡≤∏‡≤∞‡≥ç ‡≤π‡≤Ç‡≤ö‡≤ø‡≤ï‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤¨‡≥Ü‡≤Ç‡≤¨‡≤≤‡≤ø‡≤∏‡≥Å‡≤µ‡≥Å‡≤¶‡≤ø‡≤≤‡≥ç‡≤≤"); }
    }

    // Initialize
    await loadVerses();
    generateVerseImage();
  </script>
</body>
</html>
