<!DOCTYPE html>
<html lang="kn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡≤¨‡≥à‡≤¨‡≤≤‡≥ç ‡≤∂‡≥ç‡≤≤‡≥ã‡≤ï</title>
<style>
:root {
  --primary:#4a90e2;
  --secondary:#f1f1f1;
  --accent:#6a0dad;
  --text:#333;
}
html,body{margin:0;padding:0;width:100%;height:100%;font-family:'Segoe UI',sans-serif;background:var(--secondary);}
.page{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;transition:opacity 0.5s,transform 0.5s;}
.hidden{opacity:0;pointer-events:none;transform:scale(0.95);}

/* Splash */
#splash{background:linear-gradient(135deg,#6a0dad,#ff6b6b);color:#fff;flex-direction:column;text-align:center;}
#splash h1{font-size:3em;background:linear-gradient(90deg,#fff,#ffd700,#fff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:gradientText 5s infinite;}
#splash p{margin-top:15px;font-size:1.2em;opacity:0.9;}
@keyframes gradientText{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}

/* Home */
#home{flex-direction:column;overflow:auto;padding:15px;}
.app-container{width:95%;max-width:480px;background:rgba(255,255,255,0.05);backdrop-filter:blur(20px);border-radius:25px;padding:20px;text-align:center;box-shadow:0 10px 25px rgba(0,0,0,0.2);}
h1{font-size:1.3em;color:var(--primary);}
h2{font-size:1em;color:#444;margin-bottom:15px;}
canvas{width:100%;max-width:450px;border-radius:20px;margin-bottom:15px;box-shadow:0 10px 25px rgba(0,0,0,0.25);}
.buttons{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:15px;}
button{padding:12px 20px;border-radius:12px;border:none;font-size:1em;cursor:pointer;color:#fff;background:linear-gradient(90deg,#6a0dad,#ff6b6b);box-shadow:0 6px 15px rgba(0,0,0,0.3);transition:0.2s;}
button:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,0.4);background:linear-gradient(90deg,#ff6b6b,#6a0dad);}

.toast{position:fixed;bottom:25px;left:50%;transform:translateX(-50%);background:#222;color:#fff;padding:10px 18px;border-radius:25px;font-size:0.9em;opacity:0;pointer-events:none;transition:0.4s;}
.toast.show{opacity:1;pointer-events:auto;}

.banner-ads{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;margin-top:10px;}
.banner-ads > div{margin:10px 0;text-align:center;}
.banner-ads iframe{max-width:100%;}
</style>
</head>
<body>

<!-- Splash -->
<div id="splash" class="page">
  <h1>‡≤¨‡≥à‡≤¨‡≤≤‡≥ç ‡≤∂‡≥ç‡≤≤‡≥ã‡≤ï</h1>
  <p>‡≤®‡≤ø‡≤§‡≥ç‡≤Ø‡≤¶ ‡≤∂‡≥ç‡≤≤‡≥ã‡≤ï‡≤¶‡≤ø‡≤Ç‡≤¶ ‡≤™‡≥ç‡≤∞‡≥á‡≤∞‡≤£‡≥Ü</p>
</div>

<!-- Home -->
<div id="home" class="page hidden">
  <div class="app-container">
    <h1 id="verse-title">‡≤¨‡≥à‡≤¨‡≤≤‡≥ç ‡≤∂‡≥ç‡≤≤‡≥ã‡≤ï</h1>
    <h2 id="verse-subtitle">‡≤∂‡≥ç‡≤≤‡≥ã‡≤ï ‡≤≤‡≥ã‡≤°‡≥ç ‡≤Ü‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü...</h2>
    <canvas id="verse-canvas" width="450" height="450"></canvas>
    <div class="buttons">
      <button onclick="generateVerseImage()">üîÑ ‡≤π‡≥ä‡≤∏ ‡≤∂‡≥ç‡≤≤‡≥ã‡≤ï</button>
      <button onclick="downloadImage()">‚¨áÔ∏è ‡≤°‡≥å‡≤®‡≥ç‡≤≤‡≥ã‡≤°‡≥ç</button>
      <button onclick="shareImage()">üì§ ‡≤π‡≤Ç‡≤ö‡≤ø‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≤ø</button>
    </div>
    
    <!-- Banner Ads -->
    <div class="banner-ads">
      <div class="banner-classic">
        <!-- Replace YOUR_ADSTERAA_KEY with your actual Adsterra key -->
        <script type="text/javascript">
        atOptions = {
          'key' : 'YOUR_ADSTERAA_KEY',
          'format' : 'iframe',
          'height' : 60,
          'width' : 468,
          'params' : {}
        };
        </script>
        <script type="text/javascript" src="//www.highperformanceformat.com/YOUR_ADSTERAA_KEY/invoke.js"></script>
      </div>
      <div class="banner-native">
        <script async data-cfasync="false" src="//pl27523297.effectivecpmrate.com/YOUR_ADSTERAA_KEY/invoke.js"></script>
        <div id="container-YOUR_ADSTERAA_KEY"></div>
      </div>
    </div>

  </div>
</div>

<div id="toast" class="toast">‡≤™‡≥ç‡≤∞‡≤§‡≤ø‡≤ï‡≥É‡≤§‡≤ø!</div>

<script>
// Splash transition
const splash=document.getElementById('splash');
const home=document.getElementById('home');
setTimeout(()=>{
  splash.classList.add('hidden');
  home.classList.remove('hidden');
},2000);

// Canvas
const canvas=document.getElementById("verse-canvas");
const ctx=canvas.getContext("2d");
canvas.width=450; canvas.height=450;

// Toast
function showToast(msg){const t=document.getElementById("toast");t.textContent=msg;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),2500);}

// Load verses
let verses=[];
async function loadVerses(){
  try{
    const res=await fetch("kn_kjv.json");
    verses=await res.json();
    if(!Array.isArray(verses)||verses.length===0) throw new Error("JSON structure invalid");
  }catch(e){
    console.error("Failed to load Kannada Bible:",e);
    showToast("‡≤∂‡≥ç‡≤≤‡≥ã‡≤ï ‡≤≤‡≥ã‡≤°‡≥ç ‡≤Ü‡≤ó‡≤≤‡≤ø‡≤≤‡≥ç‡≤≤!");
  }
}
function getRandomVerse(){
  if(!verses.length) return null;
  return verses[Math.floor(Math.random()*verses.length)];
}

// Generate verse image
async function generateVerseImage(){
  if(!verses.length) await loadVerses();
  const verse=getRandomVerse();
  if(!verse||!verse.text){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="#333";
    ctx.font="20px Segoe UI";
    ctx.textAlign="center"; ctx.textBaseline="middle";
    ctx.fillText("‡≤∂‡≥ç‡≤≤‡≥ã‡≤ï ‡≤≤‡≤≠‡≥ç‡≤Ø‡≤µ‡≤ø‡≤≤‡≥ç‡≤≤",canvas.width/2,canvas.height/2);
    return;
  }
  const text=`${verse.text} ‚Äî ${verse.reference||""}`;
  document.getElementById("verse-title").innerText="‡≤¨‡≥à‡≤¨‡≤≤‡≥ç ‡≤∂‡≥ç‡≤≤‡≥ã‡≤ï";
  document.getElementById("verse-subtitle").innerText=verse.reference||"";

  // Optional: local images to avoid cross-origin issues
  const img = new Image();
  img.src="images/bg1.jpg"; 
  img.onload = ()=>{
    ctx.drawImage(img,0,0,canvas.width,canvas.height);
    ctx.fillStyle="rgba(0,0,0,0.35)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="#fff"; ctx.textAlign="center"; ctx.textBaseline="middle"; ctx.font="bold 22px Segoe UI";
    wrapTextCentered(ctx,text,canvas.width/2,canvas.height/2,canvas.width-40,30);
  };
}

// Wrap text
function wrapTextCentered(ctx,text,x,y,maxWidth,lineHeight){
  const words=text.split(" ");
  let line="";const lines=[];
  for(let n=0;n<words.length;n++){
    const testLine=line+words[n]+" ";
    const metrics=ctx.measureText(testLine);
    if(metrics.width>maxWidth&&n>0){lines.push(line);line=words[n]+" ";}else{line=testLine;}
  }
  lines.push(line);
  const totalHeight=lines.length*lineHeight;
  let startY=y-totalHeight/2;
  for(let i=0;i<lines.length;i++){ctx.fillText(lines[i],x,startY+i*lineHeight);}
}

// Download & Share
function downloadImage(){
  canvas.toBlob(blob=>{
    const link=document.createElement("a");
    link.download="verse.png";
    link.href=URL.createObjectURL(blob);
    link.click();
  });
}
async function shareImage(){
  if(navigator.share && navigator.canShare){
    canvas.toBlob(async blob=>{
      const file=new File([blob],"verse.png",{type:"image/png"});
      if(navigator.canShare({files:[file]})){
        try{await navigator.share({files:[file],title:"‡≤¨‡≥à‡≤¨‡≤≤‡≥ç ‡≤∂‡≥ç‡≤≤‡≥ã‡≤ï",text:"‡≤à ‡≤∂‡≥ç‡≤≤‡≥ã‡≤ï ‡≤®‡≥ã‡≤°‡≤ø!"})}catch(e){console.log(e);}
      }else showToast("‡≤à ‡≤∏‡≤æ‡≤ß‡≤®‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤π‡≤Ç‡≤ö‡≤ø‡≤ï‡≥Ü ‡≤∏‡≤æ‡≤ß‡≥ç‡≤Ø‡≤µ‡≤ø‡≤≤‡≥ç‡≤≤!");
    });
  }else showToast("‡≤à ‡≤¨‡≥ç‡≤∞‡≥å‡≤∏‡≤∞‡≥ç‚Äå‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤π‡≤Ç‡≤ö‡≤ø‡≤ï‡≥Ü ‡≤∏‡≤æ‡≤ß‡≥ç‡≤Ø‡≤µ‡≤ø‡≤≤‡≥ç‡≤≤!");
}

// Init
generateVerseImage();
</script>
</body>
</html>
